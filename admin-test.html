<div style="display:flex; gap:20px; padding:20px;">

    <!-- COLUMNA IZQUIERDA — PENDIENTES -->
    <div style="flex:1; border:1px solid #ddd; padding:15px; border-radius:10px;">
        <h2>Solicitudes Pendientes</h2>
        <div id="colPendientes">Cargando...</div>
    </div>

    <!-- COLUMNA DERECHA — ENTREGADAS -->
    <div style="flex:1; border:1px solid #ddd; padding:15px; border-radius:10px;">
        <h2>Solicitudes Entregadas</h2>
        <div id="colEntregadas">Cargando...</div>
    </div>

</div>


<script>
/* -------------------------
   CARGAR SOLICITUDES PENDIENTES
---------------------------- */
async function getSolicitudesPendientes() {
    const { data, error } = await supabase
        .from("solicitudes")
        .select(`
            id,
            email,
            docente,
            asignatura,
            fecha_solicitud,
            estado,
            materiales_solicitados (
                material,
                cantidad
            )
        `)
        .eq("estado", "Pendiente")
        .order("fecha_solicitud", { ascending: true });

    if (error) {
        console.error("Error solicitudes pendientes:", error);
        return [];
    }
    return data;
}



/* -------------------------
   CARGAR SOLICITUDES ENTREGADAS
   (estado = Entregado AND comentario_entrega NULL o "")
---------------------------- */
async function getSolicitudesEntregadas() {
    const { data, error } = await supabase
        .from("solicitudes")
        .select(`
            id,
            email,
            docente,
            asignatura,
            fecha_solicitud,
            fecha_entrega,
            estado
        `)
        .eq("estado", "Entregado")
        .or('comentario_entrega.is.null,comentario_entrega.eq.""')
        .order("fecha_entrega", { ascending: false });

    if (error) {
        console.error("Error solicitudes entregadas:", error);
        return [];
    }
    return data;
}



/* -------------------------
   RENDERIZAR TODO EN LA PÁGINA
---------------------------- */
async function cargarPanelSolicitudes() {
    const colPend = document.getElementById("colPendientes");
    const colEnt  = document.getElementById("colEntregadas");

    colPend.innerHTML = "Cargando...";
    colEnt.innerHTML = "Cargando...";

    const pendientes = await getSolicitudesPendientes();
    const entregadas = await getSolicitudesEntregadas();

    colPend.innerHTML = "";
    colEnt.innerHTML = "";

    /* ---- MOSTRAR PENDIENTES ---- */
    pendientes.forEach(s => {
        let matHTML = "";

        if (s.materiales_solicitados?.length > 0) {
            matHTML = s.materiales_solicitados
                .map(m => `<li>${m.material} — ${m.cantidad}</li>`)
                .join("");
        }

        colPend.innerHTML += `
            <div style="border:1px solid #ccc; padding:10px; margin-bottom:12px; border-radius:8px;">
                <strong>ID: ${s.id}</strong><br>
                <b>Docente:</b> ${s.docente}<br>
                <b>Asignatura:</b> ${s.asignatura}<br>
                <b>Fecha solicitud:</b> ${s.fecha_solicitud}<br><br>
                <b>Materiales:</b>
                <ul>${matHTML}</ul>
            </div>
        `;
    });

    /* ---- MOSTRAR ENTREGADAS ---- */
    entregadas.forEach(s => {
        colEnt.innerHTML += `
            <div style="border:1px solid #ccc; padding:10px; margin-bottom:12px; border-radius:8px;">
                <strong>ID: ${s.id}</strong><br>
                <b>Docente:</b> ${s.docente}<br>
                <b>Asignatura:</b> ${s.asignatura}<br>
                <b>Fecha solicitud:</b> ${s.fecha_solicitud}<br>
                <b>Fecha entrega:</b> ${s.fecha_entrega}<br>
            </div>
        `;
    });
}


/* -------------------------
   EJECUTAR AL CARGAR PÁGINA
---------------------------- */
document.addEventListener("DOMContentLoaded", cargarPanelSolicitudes);
</script>


