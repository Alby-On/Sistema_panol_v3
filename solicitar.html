<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Solicitud de Materiales</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
Â  Â  /* Variables de Color (Mismas que en las vistas anteriores) */
Â  Â  :root {
Â  Â  Â  Â  --color-primary: #004d99; /* Azul marino/institucional */
Â  Â  Â  Â  --color-secondary: #28a745; /* Verde para enviar/Ã©xito */
Â  Â  Â  Â  --color-info: #17a2b8; /* Turquesa para aÃ±adir */
Â  Â  Â  Â  --color-danger: #dc3545; /* Rojo para eliminar */
Â  Â  Â  Â  --color-muted: #6c757d; /* Gris para volver */
Â  Â  Â  Â  --color-background: #eef1f5; /* Fondo claro y suave */
Â  Â  Â  Â  --color-card: #ffffff; /* Fondo de las cajas */
Â  Â  Â  Â  --color-text: #333333; /* Texto oscuro */
Â  Â  Â  Â  --color-border: #cccccc;
Â  Â  }

Â  Â  /* Estilos Generales */
Â  Â  body {
Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  background: var(--color-background);
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  color: var(--color-text);
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  min-height: 100vh;
Â  Â  }

Â  Â  /* Caja Principal (Card) */
Â  Â  .box {
Â  Â  Â  Â  background: var(--color-card);
Â  Â  Â  Â  padding: 25px;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  max-width: 780px; /* Ancho un poco mayor para la tabla */
Â  Â  Â  Â  margin: 20px 15px;
Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  /* Encabezados */
Â  Â  h2 {
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  color: var(--color-primary);
Â  Â  Â  Â  font-size: 1.8em;
Â  Â  Â  Â  border-bottom: 2px solid var(--color-primary);
Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  }
Â  Â  h3 {Â 
Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  color: var(--color-primary);
Â  Â  Â  Â  font-size: 1.3em;
Â  Â  }

Â  Â  /* Labels e Inputs de Formulario */
Â  Â  label {Â 
Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  margin-top: 15px;Â 
Â  Â  Â  Â  color: var(--color-text);
Â  Â  }
    /* Estilos del input principal */
Â  Â  input, select {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  padding: 12px; /* Aumentado para mejor tacto en mÃ³vil */
Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  margin-top: 8px;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  transition: border-color 0.3s;
Â  Â  }
Â  Â  input:focus, select:focus {
Â  Â  Â  Â  border-color: var(--color-primary);
Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  box-shadow: 0 0 5px rgba(0, 77, 153, 0.2);
Â  Â  }

Â  Â  /* Tabla de Materiales */
Â  Â  table {Â 
Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  border-collapse: collapse;Â 
Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Sombra sutil a la tabla */
Â  Â  }
Â  Â  th, td {Â 
Â  Â  Â  Â  border: 1px solid #e0e0e0; /* Borde mÃ¡s claro */
Â  Â  Â  Â  padding: 12px;Â 
Â  Â  Â  Â  text-align: left; /* AlineaciÃ³n a la izquierda para el material */
Â  Â  }
Â  Â  th {Â 
Â  Â  Â  Â  background: var(--color-primary);Â 
Â  Â  Â  Â  color: var(--color-card);Â 
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  font-size: 0.9em;
Â  Â  }
Â  Â  #tabla tbody tr:nth-child(even) {
Â  Â  Â  Â  background-color: #f8f8f8; /* Cebra para mejor lectura */
Â  Â  }
    /* Ajuste de inputs dentro de la tabla */
Â  Â  td input {Â 
Â  Â  Â  Â  padding: 8px;Â 
Â  Â  Â  Â  font-size: 1em;Â 
Â  Â  Â  Â  border: 1px solid #d0d0d0;
        /* Eliminar mÃ¡rgenes que causaban desalineaciÃ³n */
Â  Â  Â  Â  margin: 0; 
        margin-bottom: 0;
Â  Â  }
Â  Â  #tabla td:nth-child(2) { /* Columna de Cantidad */
Â  Â  Â  Â  width: 25%;
Â  Â  Â  Â  text-align: center;
Â  Â  }
    /* Ajuste para que el input dentro del wrapper ocupe todo el ancho sin el margin-bottom */
    .autocomplete-wrapper input {
        margin-bottom: 0 !important; /* Eliminar el margen inferior del input que afecta la lista */
    }


Â  Â  /* Botones de AcciÃ³n */
Â  Â  .btnAdd, .btnRemove, .btnEnviar, .btnVolver {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  padding: 14px;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  margin-top: 12px;
Â  Â  Â  Â  transition: background-color 0.3s, opacity 0.3s;
Â  Â  }

Â  Â  .btnAdd {Â 
Â  Â  Â  Â  background: var(--color-info);Â 
Â  Â  Â  Â  color: white;Â 
Â  Â  }
Â  Â  .btnAdd:hover { background: #138496; }

Â  Â  .btnRemove {Â 
Â  Â  Â  Â  background: var(--color-danger);Â 
Â  Â  Â  Â  color: white;Â 
Â  Â  }
Â  Â  .btnRemove:hover { background: #c82333; }

Â  Â  .btnEnviar {Â 
Â  Â  Â  Â  background: var(--color-secondary);Â 
Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  margin-top: 25px; /* SeparaciÃ³n de los botones de la tabla */
Â  Â  }
Â  Â  .btnEnviar:hover { background: #1e7e34; }

Â  Â  .btnVolver {Â 
Â  Â  Â  Â  background: var(--color-muted);Â 
Â  Â  Â  Â  color: white;Â 
Â  Â  }
Â  Â  .btnVolver:hover { background: #5a6268; }

Â  Â  /* Estilos para MÃ³viles */
Â  Â  @media (max-width: 600px) {
Â  Â  Â  Â  .box {
Â  Â  Â  Â  Â  Â  margin: 10px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  h2 {
Â  Â  Â  Â  Â  Â  font-size: 1.6em;
Â  Â  Â  Â  }
Â  Â  Â  Â  th, td {
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  }
Â  Â  Â  Â  td input {
Â  Â  Â  Â  Â  Â  padding: 6px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btnAdd, .btnRemove, .btnEnviar, .btnVolver {
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  }
Â  Â  }
    /* Ajustes del autocompletado */
Â  Â  .autocomplete-wrapper { 
        position: relative;
    }
Â  Â  .autocomplete-list {
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  border: 1px solid var(--color-border); 
Â  Â  Â  Â  background: var(--color-card); 
Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  margin: 0; /* Asegurar que no haya margen */
Â  Â  Â  Â  max-height: 150px;
Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  width: 100%; 
Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
Â  Â  Â  Â  border-radius: 0 0 6px 6px; 
Â  Â  Â  Â  border-top: none; /* Eliminar el borde superior para pegarlo al input */
        /* Asegurar que el borde inferior del input sea visible */
Â  Â  }
Â  Â  .autocomplete-list li {
Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  border-bottom: 1px solid #f0f0f0; /* Borde de separaciÃ³n */
Â  Â  }
Â  Â  .autocomplete-list li:last-child {
Â  Â  Â  Â  border-bottom: none; /* ELIMINA LA LÃNEA SOMBREADA/DE SEPARACIÃ“N AL FINAL */
Â  Â  }
Â  Â  .autocomplete-list li:hover {
Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  }
</style>
</head>
<body>

<div class="box">
Â  Â  <h2>Solicitud de Materiales ğŸ“‹</h2>

Â  Â  <label for="docente">ğŸ‘¨â€ğŸ« Docente a cargo:</label>
Â  Â  <select id="docente">
Â  Â  Â  Â  <option value="">Seleccione un docente</option>
Â  Â  Â  Â  <option>AARÃ“N EDUARDO SEPÃšLVEDA MEDINA</option>
Â  Â  Â  Â  <option>ALEJANDRO GABRIEL MOENA VALDERRAMA</option>
Â  Â  Â  Â  <option>BRAYAN PATRICIO DEL VALLE AEDO</option>
Â  Â  Â  Â  <option>DANIELA FERNANDA MARTÃNEZ MARTÃNEZ</option>
Â  Â  Â  Â  <option>EDUARDO ARTURO BASTÃAS GARCÃA</option>
Â  Â  Â  Â  <option>ELÃAS ANDRÃ‰S POBLETE AVILA</option>
Â  Â  Â  Â  <option>GERARDO NICOLÃS SEPÃšLVEDA GUTIÃ‰RREZ</option>
Â  Â  Â  Â  <option>GIOVANNI ANDRÃ‰S JARA TORRES</option>
Â  Â  Â  Â  <option>JORGE ANDRÃ‰S PÃ‰REZ MILLAR</option>
Â  Â  Â  Â  <option>JOSEFA CATALINA LISBOA RIVERA</option>
Â  Â  Â  Â  <option>JULIO CESAR ALARCON MONTEROS</option>
Â  Â  Â  Â  <option>MANUEL ALEJANDRO HENRIQUEZ OLIVA</option>
Â  Â  Â  Â  <option>MARCO ANTONIO ARRIAGADA CASAS</option>
Â  Â  Â  Â  <option>PEDRO PATRICIO PEDRERO PÃ‰REZ</option>
Â  Â  Â  Â  <option>RICHARD ANTONIO VALDERRAMA SAN MARTIN</option>
Â  Â  Â  Â  <option>RICHARD NICOLÃS SANTOS MARTÃNEZ</option>
Â  Â  Â  Â  <option>ROBERTO SEBASTIAN CID LIZAMA</option>
Â  Â  Â  Â  <option>RODRIGO ALEJANDRO CONTRERAS ZÃšÃ‘IGA</option>
Â  Â  Â  Â  <option>RODRIGO ALEJANDRO GARRIDO GARRIDO</option>
Â  Â  Â  Â  <option>ROLANDO EDUARDO ORTEGA FUENTES</option>
Â  Â  Â  Â  <option>VÃCTOR EDUARDO ZAPATA MYRIK</option>
Â  Â  Â  Â  <option>OTROS DOCENTES</option>
Â  Â  </select>

<label for="asignatura">ğŸ“š Asignatura:</label>
<div class="autocomplete-wrapper">
    <input type="text" id="asignatura" placeholder="Ej: Instalaciones ElÃ©ctricas II">
</div>
Â  Â Â 
Â  Â  <h3>Materiales Solicitados</h3>

Â  Â  <table id="tabla">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Material / Equipo</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 25%;">Cantidad</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="tbody">
Â  Â  Â  Â  Â  Â  <tr>
                <td>
                    <div class="autocomplete-wrapper">
                        <input type="text" placeholder="Ej: MultÃ­metro UT33C">
                    </div>
                </td>
Â  Â  Â  Â  Â  Â  Â  Â  <td><input type="number" min="1" value="1"></td>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </tbody>
Â  Â  </table>

Â  Â  <button class="btnAdd" onclick="addRow()">â• Agregar Material</button>
Â  Â  <button class="btnRemove" onclick="removeRow()">â– Eliminar Ãšltimo</button>
Â  Â Â 
Â  Â  <button class="btnEnviar" onclick="enviar()">ğŸ“¤ Enviar Solicitud</button>
Â  Â  <button class="btnVolver" onclick="location.href='menu.html'">â†©ï¸ Volver al MenÃº</button>
</div>

<script>
/* ğŸ”— ConexiÃ³n a Supabase */
const SUPABASE_URL = "https://jwcgiuhdugjunndfpdjr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3Y2dpdWhkdWdqdW5uZGZwZGpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NTA2NTQsImV4cCI6MjA3ODUyNjY1NH0.llknOTpK1hFMDOjdyDUKUFuiyr0NwwJzNv6YdJbBsRY";
const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const user = JSON.parse(localStorage.getItem("currentUser"));
if (!user) window.location.href = "index.html";

/* ğŸŒŸ LISTA DE MATERIALES */
const materialesLista = [
"Alargador","Alcohol isopropÃ­lico","Alicate Cortante","Alicate - Punta","Alicate - Universal",
"Amarras plÃ¡sticas","Analizador de calidad energÃ­a elÃ©ctrica MI2392","Analizador de calidad energÃ­a elÃ©ctrica MI2492",
"Ampolleta E27","Amperimetro de tenaza","Antiparras","Arduino UNO","Arduino UNO - Sensores Varios",
"Bateria de 9v","Broca Metal","Broca madera","Brochas","Caja Chuqui","Caja de derivaciÃ³n","Caja EMT","Caja de herramientas",
"Calibrador de Corriente - Lazos Novus DC80L","Calibrador de corriente - Victor 05","Calibrador de procesos Fluke 725",
"Calibrador de presiÃ³n Fluke 717 500g","Calibrador de presiÃ³n manual SIKA P40.2","Calibrador de RTD Novus DC80R",
"Calibrador de termocupla Novus DC80T","Camara termografica Fluke Tis45","Cables Jumper","Cable 1,5mm","Cable 2,5mm",
"Cable de impresora","Cable de poder","Cable de RED industrial Verde","Cable HDMI","Cimpreadora Cables de red",
"Circuitos Integrados - Varios","Casco de seguridad elÃ©ctrico","CautÃ­n","Certificado de instalaciones Fluke 1664FC",
"Certificador de redes LAN Fluke DTX1800","Certificador de redes LAN Metrel","Cinta Aislante","Cinta auto fundente de goma",
"Condensador CerÃ¡mico - Varios","Condensador ElectrolÃ­tico - Varios","Cosenofimetro - Pinza de potencia Hioki 3286-20",
"Crisol estaÃ±o","Desatornillador de Cruz","Desatornillador de Paleta","Diodos - Varios","ESP32","Enchufe Simple",
"Enchufe Triple","Esmeril Angular","Etiquetador Brother","Equipo soldadura puesta a tierra","Filamento 3D","Ferrules",
"Ferrulera","Fuente de poder Riel din","FrecuencÃ­metro","Fusionadora Fibra Ã“ptica","Gas Butano","GeÃ³logo Institucional",
"Guantes","GoniÃ³metro","Horno Pozo Seco","Interruptor 9/12","Interruptor 9/15","Interruptor 9/24","Interruptor 9/32",
"Interruptor automÃ¡tico","Interruptor automÃ¡tico trifÃ¡sico","Interruptor Diferencial","Interruptor Saime","Juego Llaves Allen",
"Juego Llaves Torx","Juego de dados","Jumper","Kit cableado estructural","Led - Varios","Lima - Varios","Limpia contacto",
"Llave Francesa","Llave Inglesa","Llaves Punta corona","LuxÃ³metro Amprobe LM-120","Marco de sierra","Maqueta de domÃ³tica - Schneider",
"Maqueta de domÃ³tica - Varios","Martillo","Mazo de goma","Medidor de AislaciÃ³n Megabras MI1050e","Medidor de AislaciÃ³n AEMC",
"Medidor de factor de potencia PCE-PCM","Medidor ElÃ©ctrico","Medidor de AislaciÃ³n Hioki IR4056-20","MÃ³dulos LAB VOLT",
"Motor 12v DC","Motor 24v DC","Multimetro AnalÃ³gico","Multimetro digital","Nock Out HidrÃ¡ulico","Nivel","Osciloscopio Digital",
"Osciloscopio Digital de mano","Parada de Emergencia","Pasta de soldar","Pesa","Pelacables","PG - Siemens","Pila AA","Pila AAA",
"Pistola de calor","Probador de fase","Protoboard","Punta taladro PH2","Remachadora POP","RelÃ© - Varios","Resistencias - Varios",
"Robot mÃ³vil York","Rollo cable de RED cat6","Serrucho","Set EPP","Sensores - Varios","Sonda Osciloscopio","Soplete",
"TacÃ³metro Amprobe Tach-20","Tarjeta de adquisiciÃ³n de datos MyDAQ","Taladro InalÃ¡mbrico","Termocupla - Varios",
"Transductor de presiÃ³n Danfos MBS1700","Transistores - Varios","Terminales - Varios","Transformador de 12v",
"Transformador de 9v","EstaÃ±o","Fusibles - tipo Hilo","Fusibles - Varios","Teslameter Tunkia TD8620","TelurÃ³metro Megbras MTD - 20KWr",
"TelurÃ³metro Megger DET4TCR2","Wattmetro Fluke 345"
];

/* ğŸŒŸ LISTA DE ASIGNATURAS */
const asignaturasLista = [
"Algoritmos y ProgramaciÃ³n Avanzada",
"AnÃ¡lisis de Circuitos ElÃ©ctricos",
"AnÃ¡lisis de Fallas en Sistemas MecatrÃ³nicos",
"Aplicaciones de Electromagnetismo",
"Arquitectura de Comunicaciones Industriales",
"AutomatizaciÃ³n Industrial",
"Control con Inteligencia Artificial",
"Control de Fluidos Industriales",
"Control de Sistemas ElectroneumÃ¡ticos",
"ConversiÃ³n ElectromecÃ¡nica de la EnergÃ­a",
"DiseÃ±o Asistido por Computador",
"DiseÃ±o de Proyectos ElÃ©ctricos en Baja TensiÃ³n",
"DiseÃ±o de Proyectos ElÃ©ctricos en Media y Alta TensiÃ³n",
"Electricidad Aplicada a la AutomatizaciÃ³n",
"ElectrÃ³nica AnalÃ³gica y Digital",
"ElectrÃ³nica de Potencia y Accionamientos",
"ElectrÃ³nica de Potencia y Microredes",
"ElectrÃ³nica Programable e InstrumentaciÃ³n",
"EnergÃ­as Renovables No Convencionales",
"EnergÃ­as Renovables y Electromovilidad",
"EvaluaciÃ³n de Proyectos de IngenierÃ­a ElÃ©ctrica",
"Fundamentos del Mantenimiento para la AutomatizaciÃ³n",
"GestiÃ³n del Mantenimiento",
"IntegraciÃ³n de Redes Industriales",
"Instalaciones ElÃ©ctricas en Baja TensiÃ³n",
"Instalaciones ElÃ©ctricas Inteligentes",
"InstrumentaciÃ³n Industrial",
"InstrumentaciÃ³n Inteligente",
"Inteligencia Artificial Aplicada al Mantenimiento",
"IntroducciÃ³n a la AutomatizaciÃ³n y RobÃ³tica",
"MÃ¡quinas ElÃ©ctricas y Accionamientos",
"Mantenimiento de Circuitos ElÃ©ctricos y ElectrÃ³nicos de Potencia",
"Mantenimiento de Redes de ComunicaciÃ³n e InstrumentaciÃ³n de Campo",
"Mantenimiento de Sistemas HidrÃ¡ulicos y NeumÃ¡ticos",
"Mantenimiento de Sistemas Industriales Automatizados",
"Mantenimiento de Sistemas RobÃ³ticos",
"Mantenimiento ElÃ©ctrico-Instrumentista",
"Manufactura Avanzada",
"Mercado, Normativa y Calidad de Suministro",
"Plataforma SCADA",
"ProgramaciÃ³n Avanzada de Controladores",
"ProgramaciÃ³n de Controladores",
"ProgramaciÃ³n de PLC",
"ProgramaciÃ³n Orientada a Industrias Digitales",
"Proyecto de TÃ­tulo para la AutomatizaciÃ³n I",
"Proyecto ElÃ©ctrico Integrado",
"Proyectos de IngenierÃ­a en Sistemas de EnergÃ­a ElÃ©ctrica",
"Proyectos ElÃ©ctricos Integrados",
"Protecciones ElÃ©ctricas Avanzadas",
"Protecciones ElÃ©ctricas y Puestas a Tierra",
"Redes ElÃ©ctricas I",
"Redes ElÃ©ctricas II",
"Redes ElÃ©ctricas Inteligentes",
"Redes ElÃ©ctricas y Subestaciones",
"Redes y Subestaciones ElÃ©ctricas I",
"Redes y Subestaciones ElÃ©ctricas II",
"RobÃ³tica Aplicada a Procesos Industriales",
"RobÃ³tica Avanzada",
"RobÃ³tica Industrial",
"Seguridad Industrial y Riesgos ElÃ©ctricos",
"Seguridad y Riesgos Industriales",
"SimulaciÃ³n y Control de Procesos Industriales",
"SimulaciÃ³n y DiseÃ±o 3D",
"Sistemas de Almacenamiento de EnergÃ­a",
"Sistemas de Control",
"Sistemas de Control Avanzado y Distribuido",
"Sistemas ElÃ©ctricos de Potencia",
"Sistemas ElÃ©ctricos de Potencia I",
"Sistemas ElÃ©ctricos de Potencia II",
"Taller de InstalaciÃ³n y Mantenimiento de Sistemas Automatizados",
"Taller de OperaciÃ³n y Mantenimiento de Sistemas Automatizados",
"Telecomunicaciones y Conectividad",
"TÃ©cnicas de Ultrasonido para Mantenimiento"
];


/* ğŸŒŸ FUNCIÃ“N GENÃ‰RICA DE AUTOCOMPLETADO (Actualizada) */
function enableAutocomplete(input, listaOpciones) {
    // 1. Busca el contenedor 'autocomplete-wrapper' (ahora se aÃ±ade en el HTML)
    const wrapper = input.closest('.autocomplete-wrapper');
    if (!wrapper) {
        console.error('El input debe estar dentro de un div con clase .autocomplete-wrapper');
        return;
    }

    // 2. Crear la lista si no existe
    let lista = wrapper.querySelector(".autocomplete-list");
    if (!lista) {
        lista = document.createElement("ul");
        lista.className = "autocomplete-list";
        lista.style.display = 'none'; // Oculta inicialmente
        wrapper.appendChild(lista);
    }

Â  Â  input.addEventListener("input", () => {
Â  Â  Â  Â  const val = input.value.toLowerCase();
Â  Â  Â  Â  lista.innerHTML = '';
Â  Â  Â  Â  if (!val) {
            lista.style.display = 'none'; 
            return;
        }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const coincidencias = listaOpciones.filter(item => item.toLowerCase().includes(val));
Â  Â  Â  Â Â 
Â  Â  Â  Â  coincidencias.forEach(item => {
Â  Â  Â  Â  Â  Â  const li = document.createElement("li");
Â  Â  Â  Â  Â  Â  li.textContent = item;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Usamos onmousedown para evitar que el blur del input cierre la lista
Â  Â  Â  Â  Â  Â  li.onmousedown = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); 
Â  Â  Â  Â  Â  Â  Â  Â  input.value = item;
Â  Â  Â  Â  Â  Â  Â  Â  lista.style.display = 'none'; // Cierra la lista
                input.focus(); // Mantener el foco o devolverlo al input
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  lista.appendChild(li);
Â  Â  Â  Â  });

        lista.style.display = coincidencias.length > 0 ? 'block' : 'none'; // Muestra/oculta
Â  Â  });

Â  Â  input.addEventListener("blur", () => {
Â  Â  Â  Â  // Retraso para dar tiempo al onmousedown
Â  Â  Â  Â  setTimeout(() => { lista.style.display = 'none'; }, 150);
Â  Â  });
}


/* â• AÃ±adir fila (Actualizada) */
function addRow() {
Â  Â  const tr = document.createElement("tr");
Â  Â  tr.innerHTML = `
Â  Â  Â  Â  <td>
            <div class="autocomplete-wrapper">
                <input type="text" placeholder="Ej: Cables de prueba">
            </div>
        </td>
Â  Â  Â  Â  <td><input type="number" min="1" value="1"></td>`;
Â  Â  document.getElementById("tbody").appendChild(tr);

Â  Â  const inputNuevo = tr.querySelector("input[type=text]");
Â  Â  enableAutocomplete(inputNuevo, materialesLista);
}


/* â– Eliminar fila */
function removeRow() {
Â  Â  const tbody = document.getElementById("tbody");
Â  Â  if (tbody.rows.length > 1) tbody.deleteRow(tbody.rows.length - 1);
Â  Â  else alert("Debe haber al menos un material.");
}

/* ğŸ“¤ Enviar Solicitud */
async function enviar() {
Â  Â  const btn = document.querySelector(".btnEnviar");
Â  Â  btn.disabled = true;
Â  Â  btn.innerText = "Enviando...";

Â  Â  const docente = document.getElementById("docente").value;
Â  Â  const asignatura = document.getElementById("asignatura").value.trim();
Â  Â  const filas = document.querySelectorAll("#tbody tr");
Â  Â  const materiales = [];

Â  Â  if (!docente) return finishError("Seleccione un docente.");
Â  Â  if (!asignatura) return finishError("Ingrese la asignatura.");

Â  Â  filas.forEach(f => {
Â  Â  Â  Â  // Asegurarse de seleccionar el input dentro del wrapper si existe
        const inputMaterial = f.children[0].querySelector("input");
        const inputCantidad = f.children[1].querySelector("input");
        
Â  Â  Â  Â  const nombre = inputMaterial ? inputMaterial.value.trim() : "";
Â  Â  Â  Â  const cantidad = inputCantidad ? parseInt(inputCantidad.value.trim(), 10) : 0;
        
Â  Â  Â  Â  if (nombre && cantidad && cantidad > 0) materiales.push({ material: nombre, cantidad });
Â  Â  });

Â  Â  if (materiales.length === 0) return finishError("Debe ingresar al menos un material vÃ¡lido.");

Â  Â  try {
Â  Â  Â  Â  /* 1ï¸âƒ£ Insertar solicitud */
Â  Â  Â  Â  const { data: solicitud, error } = await supabaseClient
Â  Â  Â  Â  Â  Â  .from("solicitudes")
Â  Â  Â  Â  Â  Â  .insert([{
Â  Â  Â  Â  Â  Â  Â  Â  email: user.email,
Â  Â  Â  Â  Â  Â  Â  Â  docente,
Â  Â  Â  Â  Â  Â  Â  Â  asignatura,
Â  Â  Â  Â  Â  Â  Â  Â  fecha_solicitud: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  estado: "Pendiente"
Â  Â  Â  Â  Â  Â  }])
Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  .single();

Â  Â  Â  Â  if (error) throw error;

Â  Â  Â  Â  /* 2ï¸âƒ£ Insertar materiales */
Â  Â  Â  Â  for (const m of materiales) {
Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient
Â  Â  Â  Â  Â  Â  Â  Â  .from("materiales_solicitados")
Â  Â  Â  Â  Â  Â  Â  Â  .insert([{ id_solicitud: solicitud.id, material: m.material, cantidad: m.cantidad }]);
Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  }

Â  Â  Â  Â  alert("âœ… Solicitud enviada con Ã©xito.");
Â  Â  Â  Â  window.location.href = "menu.html";

Â  Â  } catch (err) {
Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  finishError("Error al enviar: " + err.message);
Â  Â  }
}

function finishError(msg) {
Â  Â  alert("âŒ " + msg);
Â  Â  const btn = document.querySelector(".btnEnviar");
Â  Â  btn.disabled = false;
Â  Â  btn.innerText = "Enviar Solicitud";
}

/* -------------------------------------------------------------------
Â  Â CARGAR DATOS CUANDO VIENE DESDE "REPETIR SOLICITUD"
------------------------------------------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
Â  Â  // Activar autocompletado para el campo de asignatura
Â  Â  const inputAsignatura = document.getElementById("asignatura");
Â  Â  enableAutocomplete(inputAsignatura, asignaturasLista);

Â  Â  // Activar autocompletado en todos los inputs de material existentes
Â  Â  document.querySelectorAll("#tbody input[type=text]").forEach(input => {
Â  Â  Â  Â  enableAutocomplete(input, materialesLista);
Â  Â  });

Â  Â  // Cargar datos si viene desde "Repetir Solicitud"
Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  const docente = params.get("docente");
Â  Â  const asignatura = params.get("asignatura");
Â  Â  const materiales = JSON.parse(params.get("materiales") || "[]");
Â  Â  const cantidades = JSON.parse(params.get("cantidades") || "[]");

Â  Â  if (docente) document.getElementById("docente").value = docente;
Â  Â  if (asignatura) document.getElementById("asignatura").value = asignatura;

Â  Â  const tbody = document.getElementById("tbody");
Â  Â  if (materiales.length > 0) {
Â  Â  Â  Â  tbody.innerHTML = "";
Â  Â  Â  Â  for (let i = 0; i < materiales.length; i++) {
Â  Â  Â  Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  Â  Â  Â  tr.innerHTML = `
                <td>
                    <div class="autocomplete-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" value="${materiales[i]}" />
                    </div>
                </td>
Â  Â  Â  Â  Â  Â  Â  Â  <td><input type="number" min="1" value="${cantidades[i] || 1}" /></td>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Activar autocompletado para cada input de material cargado
Â  Â  Â  Â  Â  Â  const inputMaterial = tr.querySelector("input[type=text]");
Â  Â  Â  Â  Â  Â  enableAutocomplete(inputMaterial, materialesLista);
Â  Â  Â  Â  }
Â  Â  }
});
</script>

</body>
</html>
